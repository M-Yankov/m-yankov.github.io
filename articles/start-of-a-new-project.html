<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starting a new project</title>
</head>

<body>
    <p>
        Every project starts with a plan. That's not right. In my option it should start
        with a problem to be solved.
    </p>
    <p>
        Problem description: there are a lot of users that still are using
        <a href="https://www8.garmin.com/support/download_details.jsp?id=6591">Garmin Virb Edit</a>
        for editing videos recorded with an action camera and a garmin device. It adds
        telemetry data as an overlay of the video. It look like the video below:
        <iframe width="560" height="315" src="https://www.youtube.com/embed/s5v9ZCwcung?si=Hq4D0IZkzVDAzcFB"
            title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen></iframe>
    </p>
    <p>
        Virb Edit is no longer supported by Garmin, it just abandoned. Therefore, issues start appearing,
        but good people shared some workaround, like the default browser issue. Around August 2023 a new
        issue pop up, saying that there is a script error. <a
            href="https://forums.garmin.com/apps-software/mac-windows-software/f/virb-edit-windows/294764/script-error-on-that-page---virb-edit---api-issues/1667072#1667072">This
            post</a>
        and the thread itself contains enough information about the issue. People there suggest workarounds,
        using other software, but it's not a complete solution.
    </p>
    <p>
        Virb Edit is a an old desktop application written with .NET C#, which mean it can be de-complied.
        After a while browsing the source code it turns out that the application renders a web-page inside. It
        uses <a href="https://static.garmincdn.com/desktop-chandler/virbedit/maps/v8/google/index.html"> this page</a>
        and sends script commands to predefined JS functions form the page. This may lead to many problems such as the
        recent one mentioned from the Garmin forums above. It looks like it was caused by update of an Google maps APIs.
        Virb Edit itself points to an very old version of the Google maps APIs, but they now works differently. Only
        the last two versions stays supported (<i>very good accurate solution, admire them</i>). But the Virb Edit is
        not adapted to use new version of the Google Maps APIs. Soon or later a problem appears and blocks usage of the
        application. Investigating exact problem which parameter fails, which code line, function or method will be
        waste of time, because the solution should require a lot of time for fix and there is not guaranty everything
        will
        work. Applying a "crack-fix" may not be a solution and general issue is that the source code of Virb Edit
        is not uploaded anywhere. According to Garmin it should be <a
            href="https://developer.garmin.com/open-source/virb/">here</a>, but the downloaded
        files for Windows contains only ffmpeg libraries.
    </p>
    <p>
        My vision of the situation: some people suggest using software called "Telemetry overlay", but it's paid.
        Yeah money solves most problems in the world, but hold on. Why it should be paid? I do not make money of that
        videos, I make them as a hobby and to share my vision behind the handlebars of my rides. I guess other people
        are in a common situation - they don't like to pay. Going outdoor for sports adventures costs time, organization
        and preparation. It's for fun, but sometimes it may evolve to be better.
    </p>
    <p>
        First of all I will do this for me. I use only the overlay <code>.png</code> pictures generated by Virb Edit,
        then i put them in another software called Davinci Resolve (BlackMagic Design). Inside the program, the video
        and telemetry data is synced, highlight moments are cropped and the final step is the video to be compiled.
        Working with Davinci Resolve is fine, but collecting the telemetry data is pain.
    </p>
    <p>
        My solution is to make very very simple and working version of an web application (a web job maybe
        or something like that) that will process telemetry data in a storage (TBD), and then it can be
        downloaded. My scenario would be: after an activity is saved in Garmin Connect it can be exported
        from the website and later provided for processing. And here are the detailed technical steps below.
    </p>
    <p>
    <ol>
        <li>First of all, how to read a .fit file (generated by Garmin device)</li>
        <ul>
            <li>
                For my good sake there is a downloadable SDK (examples) of encoding/decoding
                .fit files.
            </li>
        </ul>
        <li>
            I need graphics/images for the telemetry data (speed/elevation/incline/hearth-beat
            etc.)
            <ul>
                <li>
                    I can steal it from Virb Edit installation directory, but need more colors,
                    rotations it may require more effort to make it perfect.
                </li>
            </ul>
        </li>
        <li>
            The most difficult part is to render latitude and longitude coordinates into a map.
            <ul>
                <li>
                    Really not sure how this can be implemented. First variation could be a simple
                    square. From the coordinates list need to find boundaries (top-left, bottom-right)
                    and somehow make a formula to calculate how large to be the image. Need more
                    improvisations and research.
                </li>
            </ul>
        </li>
        <li>
            Also need to decide how often an image of telemetry data will be generated. Render every
            millisecond definitely is not a solution, because the result will be a lot duplicates 
            images. Typical video clip from an action camera contains 60 frames per second. Again 60
            images for second is not a solution. Maybe 2 or 4 is fine.
            <i>This also depends how they can be integrated in Davinci Resolve</i>
        </li>
        <li>
            Making a range which part of the .fit file to be rendered is an option too.
            In my case I don't record the whole activity. I make several short clips.
        </li>
        <li>
            When images are ready, they needs to be stored somewhere for download (TBD).
            Azure could be a solution.
        </li>
    </ol>
    </p>
    <p>
        All of the steps above will meet some difficulties. The success of the project 
        depends how much effort takes to resolve each issue.
    </p>
</body>

</html>